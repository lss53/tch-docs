<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
<head>
  <!-- SEO 与兼容性设置 -->
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>TchDocs</title>

  <!-- 网站图标 -->
  <link rel="icon" href="_media/favicon.ico">

  <!-- 解决主题闪烁问题的关键脚本 -->
  <script>
    (function() {
      // 切换主题的核心函数，它会给 <body> 添加或移除 'dark' 类
      function applyTheme(theme) {
        if (theme === 'dark') {
          document.body.classList.add('dark');
        } else {
          document.body.classList.remove('dark');
        }
      }

      try {
        // 1. 优先从本地存储获取用户之前的选择
        var savedTheme = localStorage.getItem('THEME');
        if (savedTheme) {
          applyTheme(savedTheme);
          return; // 如果有保存的选择，直接应用并退出
        }

        // 2. 如果没有保存的选择，则根据系统偏好设置
        var osPreference = window.matchMedia('(prefers-color-scheme: dark)').matches;
        if (osPreference) {
          applyTheme('dark');
        }
      } catch (e) {
        // 出错时忽略，保证页面正常渲染
      }
    })();
  </script>

  <!-- 性能优化：预连接到 CDN，加快资源加载速度 -->
  <link rel="preconnect" href="//cdn.jsdelivr.net" crossorigin>
  <link rel="dns-prefetch" href="//cdn.jsdelivr.net">

  <!-- 预连接到字体服务器，加速后续下载 -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  
  <!-- 异步加载字体，使用 display=swap 避免渲染阻塞 -->
  <link href="https://fonts.googleapis.com/css2?family=PT+Sans&family=Roboto+Mono&family=Source+Sans+Pro&display=swap" rel="stylesheet">

  <!-- 样式文件 -->
  <!-- 您可以切换使用 Docsify 官方主题或自定义主题 -->
  <!-- <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/docsify/themes/vue.css"> -->
  <link rel="stylesheet" href="assets/css/theme.css"/>

  <!-- 为主题切换按钮添加初始隐藏样式和过渡效果 -->
  <style>
    #theme-toggle {
      visibility: hidden; /* 默认隐藏 */
      opacity: 0;         /* 默认全透明 */
      transition: opacity 0.3s ease-in-out; /* 添加一个平滑的淡入效果 */
    }
  </style>
</head>

<body>
  <!-- 主题切换按钮：使用 button 元素以获得更好的语义和可访问性 -->
  <button id="theme-toggle" aria-label="切换主题">
    <svg class="icon" viewBox="0 0 48 48" aria-hidden="true">
      <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
      3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
      13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"></path>
    </svg>
  </button>

  <!-- Docsify 渲染的核心挂载点 -->
  <div id="app"></div>

  <!-- Docsify 配置 -->
  <script>
    window.$docsify = {
      //================================================================
      // ◎ 核心配置
      //================================================================
      name: 'TchDocs', // 显示在侧边栏顶部的网站名称
      // repo: 'https://github.com/lss53/tch-docs', // 设置后将在右上角显示 GitHub 角标
      loadSidebar: true, // 加载自定义侧边栏 _sidebar.md
      // loadNavbar: true, // 加载自定义导航栏 _navbar.md
      subMaxLevel: 4, // 侧边栏目录最大深度
      autoHeader: true, // 自动将 _sidebar.md 的顶级标题作为每一页的页眉
      auto2top: true, // 切换页面后，自动滚动到页面顶部
      mergeNavbar: true, // 在小屏幕上合并导航栏到侧边栏
      relativePath: true, 

      //================================================================
      // ◎ 别名配置 (Alias)
      //================================================================
      alias: {
      },

      //================================================================
      // ◎ 插件配置
      //================================================================

      // 主题切换插件 (theme-toggle)
      theme: {
        defaultTheme: 'light' // 或 'dark'
      },

      // 搜索插件 (search)
      search: {
        placeholder: '输入关键字搜索',
        noData: '没有找到结果!',
        depth: 3, // 搜索标题的最大层级
      },
      
      // 图片缩放插件 (zoom-image)
      zoomImage: {
        // 默认配置已足够好用，通常无需额外设置
        // options: {
        //   bgColor: 'rgba(0,0,0,0.8)'
        // }
      },
      
      // 复制到剪贴板
      copyCode: {
        buttonText: {
          '/': '点击复制',
        },
        errorText: {
          '/': '错误',
        },
        successText: {
          '/': '已复制',
        },
      },
      
      // 返回顶部插件 (back-to-top) - 自定义插件
      backToTop: {
        backgroundColor: 'var(--accent)', // 按钮背景色，使用CSS变量以匹配主题
        textColor: '#ffffff', // 按钮图标颜色
        cornerOffset: 25, // 距离右下角的偏移量 (px)
        scrollDuration: 500, // 滚动动画时长 (ms)
        showWhenScrollTopIs: 300, // 页面向下滚动超过该值后显示 (px)
        size: 40 // 按钮直径 (px)
      },

      // 数学公式插件 (MathJax) - 自定义插件
      mathjax: {
        // 如果需要，可以在这里对 MathJax 进行自定义配置
        /*
        tex: {
          macros: {
            R: '\\mathbb{R}', // 定义宏 \R
          }
        }
        */
      }
    };
  </script>

  <!-- ================================================================ -->
  <!-- ◎ 外部脚本加载 -->
  <!-- 核心库必须最先加载 -->
  <script src="//cdn.jsdelivr.net/npm/docsify/lib/docsify.min.js"></script>

  <!-- 插件脚本 -->
  <!-- 语法高亮：按需加载语言以减小体积 -->
  <script src="//cdn.jsdelivr.net/npm/prismjs@1/components/prism-python.js"></script>
  <script src="//cdn.jsdelivr.net/npm/prismjs@1/components/prism-bash.js"></script>
  <script src="//cdn.jsdelivr.net/npm/prismjs@1/components/prism-javascript.js"></script>
  <script src="//cdn.jsdelivr.net/npm/prismjs@1/components/prism-json.js"></script>
  
  <!-- 官方插件 -->
  <script src="//cdn.jsdelivr.net/npm/docsify/lib/plugins/search.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/docsify/lib/plugins/zoom-image.min.js"></script>
  <script src="https://unpkg.com/docsify-copy-code"></script>

  <!-- 自定义脚本（本地） -->
  <script src="assets/js/theme-toggle.js"></script> <!-- 主题切换功能 -->
  <script src="assets/js/mathjax.js"></script> <!-- MathJax数学公式支持 -->
  <script src="assets/js/back-to-top.js"></script> <!-- 返回顶部功能 -->
  
</body>
</html>